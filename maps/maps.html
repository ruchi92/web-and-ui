<!DOCTYPE html>
<html>
<meta charset="utf-8"/>
<head>
<script
src="http://maps.googleapis.com/maps/api/js">
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script>
var myCenter=new google.maps.LatLng(37.344717,-121.979666);
var json = (function () { 
            var json = null; 
            $.ajax({ 
                'async': false, 
                'global': false, 
                'url': "http://localhost:3000/data", 
                'dataType': "json", 
                'success': function (data) {
                     json = data; 
                 }
            });
            return json;
        })();
console.log(json);


function initialize()
{
var latlong = new google.maps.LatLng(37.542571,-121.993037);
var mapProp = {
  center:latlong,
  zoom:8.5,
  mapTypeId:google.maps.MapTypeId.ROADMAP
  };

var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

for(var i = 0 ; i < json.locations.location.length;i++){
        var latitude = json.locations.location[i].latitude;
        var longitude = json.locations.location[i].longitude;
        console.log(latitude);
        console.log(longitude);
        var marker_position = new google.maps.LatLng(latitude,longitude);
        if(json.locations.location[i].type == "RetailLocation"){
            var marker = new google.maps.Marker({
                position: marker_position,
                icon: 'http://localhost:3000/images_g'
            });
                marker.setMap(map);
            }
         
         if(json.locations.location[i].type == "Distribution Facility"){
            var marker = new google.maps.Marker({
                position: marker_position,
                icon: 'http://localhost:3000/images_r'
            });
                marker.setMap(map);
            
            }

         if(json.locations.location[i].type == "Call Center"){
            var marker = new google.maps.Marker({
                position: marker_position,
                icon: 'http://localhost:3000/images_b'
            });
                marker.setMap(map);
            
            }

        if(json.locations.location[i].type == "HeadQuarters"){
            var marker=new google.maps.Marker({
                position: marker_position,
                icon: 'http://localhost:3000/images_w'
            });
                marker.setMap(map);
            
            }    
        }
      for (var i = 0; i < json.locations.location.length;i++) {
                // Add the circle for this city to the map.
                if(json.locations.location[i].type == "RetailLocation"){
                var retailCircle = new google.maps.Circle({
                  strokeColor: '#3333FF',
                  strokeOpacity: 0.8,
                  strokeWeight: 2,
                  fillColor: '#3333FF',
                  fillOpacity: 0.1,
                  map: map,
                  center: new google.maps.LatLng(json.locations.location[i].latitude,json.locations.location[i].longitude),
                  radius: Math.sqrt(json.locations.location[i].$revenue) * 2
                });
          }
        }
      }

google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>
<div id="googleMap" style="width:500px;height:380px;"></div>
</body>
</html>
